'''
Here we will gonna deploy our smart contract to the blockchain.
'''
import json

from web3 import Web3

genache_url = "http://127.0.0.1:8545"
web3 = Web3(Web3.HTTPProvider(genache_url))

print(web3.is_connected())
web3.eth.default_account = web3.eth.accounts[0]

abi = json.loads("""[{"inputs":[],"name":"Greeter","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"greet","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"greeting","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"_greeting","type":"string"}],"name":"setGreeting","outputs":[],"stateMutability":"nonpayable","type":"function"}]""")
bytecode = '608060405234801561000f575f80fd5b5061046a8061001d5f395ff3fe608060405234801561000f575f80fd5b506004361061004a575f3560e01c8063777256c41461004e578063a413686214610058578063cfae32171461006b578063ef690cc014610089575b5f80fd5b610056610091565b005b6100566100663660046101f9565b6100bc565b6100736100cb565b60405161008091906102a4565b60405180910390f35b61007361015a565b60408051808201909152600581526448656c6c6f60d81b60208201525f906100b99082610374565b50565b5f6100c78282610374565b5050565b60605f80546100d9906102f0565b80601f0160208091040260200160405190810160405280929190818152602001828054610105906102f0565b80156101505780601f1061012757610100808354040283529160200191610150565b820191905f5260205f20905b81548152906001019060200180831161013357829003601f168201915b5050505050905090565b5f8054610166906102f0565b80601f0160208091040260200160405190810160405280929190818152602001828054610192906102f0565b80156101dd5780601f106101b4576101008083540402835291602001916101dd565b820191905f5260205f20905b8154815290600101906020018083116101c057829003601f168201915b505050505081565b634e487b7160e01b5f52604160045260245ffd5b5f60208284031215610209575f80fd5b813567ffffffffffffffff80821115610220575f80fd5b818401915084601f830112610233575f80fd5b813581811115610245576102456101e5565b604051601f8201601f19908116603f0116810190838211818310171561026d5761026d6101e5565b81604052828152876020848701011115610285575f80fd5b826020860160208301375f928101602001929092525095945050505050565b5f602080835283518060208501525f5b818110156102d0578581018301518582016040015282016102b4565b505f604082860101526040601f19601f8301168501019250505092915050565b600181811c9082168061030457607f821691505b60208210810361032257634e487b7160e01b5f52602260045260245ffd5b50919050565b601f82111561036f57805f5260205f20601f840160051c8101602085101561034d5750805b601f840160051c820191505b8181101561036c575f8155600101610359565b50505b505050565b815167ffffffffffffffff81111561038e5761038e6101e5565b6103a28161039c84546102f0565b84610328565b602080601f8311600181146103d5575f84156103be5750858301515b5f19600386901b1c1916600185901b17855561042c565b5f85815260208120601f198616915b82811015610403578886015182559484019460019091019084016103e4565b508582101561042057878501515f19600388901b60f8161c191681555b505060018460011b0185555b50505050505056fea2646970667358221220398d7ff9ffb82daa3ae5ac0c9114f1190ac68b698f4b9b43fff542c016bffb6864736f6c63430008180033'

Greeter = web3.eth.contract(abi=abi, bytecode=bytecode)

print(Greeter)

tx_hash = Greeter.constructor().transact()

print(tx_hash)

tx_receipt = web3.eth.wait_for_transaction_receipt(tx_hash)

print(tx_receipt)

contract = web3.eth.contract(address=tx_receipt.contractAddress, abi=abi)

print(contract.functions.greet().call())

# # Now if we have to update the greeting

# tx_hash = contract.functions.set_greeting(
#     "Hello from the other side").transact()

# tx_receipt = web3.eth.wait_for_transaction_receipt(tx_hash)

# print(contract.functions.greet().call())
